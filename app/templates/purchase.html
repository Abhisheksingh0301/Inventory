{% extends "layout.html" %}

{% block title %}Purchases - Inventory Management{% endblock %}

{% block content %}

<div class="flex justify-between items-center mb-8">
  <div>
    <h1 class="text-3xl font-bold text-gray-900">Purchases</h1>
    <p class="text-gray-600 mt-2">Manage purchase orders and stock replenishment</p>
  </div>
  <a href="{{ url_for('main.add_purchase') }}"
    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200">
    Add New Purchase
  </a>
</div>

<!-- Search Bar -->
<div class="mb-6">
  <form method="GET" class="flex sm:flex-row flex-col gap-4">
    <input type="text" name="search" value="{{ search }}" placeholder="Search products by invoice no. or brand name ..."
      class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
    <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition duration-200">
      Search
    </button>
  </form>
</div>


<div class="container mx-auto px-4 sm:px-6 lg:px-8">


  <!-- Purchase History Table -->
  <h2 class="text-xl sm:text-2xl font-semibold mt-6 sm:mt-8 mb-4">Purchase Records</h2>
  <div class="overflow-x-auto">
    <table class="w-full border-collapse border border-gray-300">
      <thead class="bg-blue-100">
        <tr>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Invoice No.</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Product</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Brand</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Size</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Supplier</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Quantity</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Price (₹)</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Taxable<br> Value (₹)</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">GST % / ₹</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Total</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Invoice Date</th>
          <th class="border px-2 sm:px-4 py-2 text-left text-xs sm:text-sm">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for purchase in purchases %}
        <tr class="hover:bg-blue-50">
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.invoice_number }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.product_name }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.product_brand }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.product_size }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.supplier_name }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.quantity }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">₹{{ "%.2f"|format(purchase.purchase_price) }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">₹{{ "%.2f"|format(purchase.taxable_value) }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.cgst_rate + purchase.sgst_rate +
            purchase.igst_rate }}% / ₹{{
            "%.2f"|format(purchase.cgst_amount + purchase.sgst_amount + purchase.igst_amount) }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm"> ₹{{ "%.2f"|format(purchase.taxable_value +
            purchase.cgst_amount + purchase.sgst_amount + purchase.igst_amount) }}</td>
          <td class="border px-2 sm:px-4 py-2 text-xs sm:text-sm">{{ purchase.invoice_date | format_dmy }}</td>
          <td class="border px-2 sm:px-4 py-2 text-sm">
            <form action="{{ url_for('main.delete_purchase', purchase_id=purchase.id) }}" method="POST"
              onsubmit="return confirm('Are you sure you want to delete this purchase record?');">
              <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded  cursor-pointer ">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="16" class="border px-2 sm:px-4 py-2 text-center text-xs sm:text-sm">No purchases yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}